# Research Archive "A Bayesian Synthetic Control Method: Quantifying uncertainty about the causal effect of a policy intervention"

This research archive contains all the necessary information (code and data) to reproduce all results of the thesis of Carlos Gonzalez Poses. In the main text of the theses, this research archive is also refered to as 'Online Supplementary Material'.

The thesis consists of 1) an extensive simulation study using R and Stan, aimed at comparing the newly developed - detailed in the manuscript - Horseshoe Simplex Priors BSCM and Horseshoe Priors BSCM to the Standard Synthetic Control Method; and 2) a (much smaller) reanalysis of data originally presented in Abadie et al. (2010) using the Horseshoe Simplex BSCM and the Horsesheo Simplex Priros BSCM. There are 4 folders: code, sim-output, data, and figures. An overview of the contents of each folder follows.

## Content of each folder

1. **code**: contains four sub-folders. Since every subfolder contains several scripts, and the relationships between the scripts are rather complex, we include explicit information about all the scripts and how to run them in a separate file "code/detailed-description.md"
  - 'run-simulation' includes all the scrips needed to run the simulation. They result in 56.000 files.
  - 'simulation-post-processing' includes all information needed to summarize the 56000 simulation files to 7 datasets that are easier to handle, described in "code/detailed-description.md"
  - 'stan' contains the .stan files for the two bayesian models.
  - 'analysis-and-figures' contains the code needed to reproduce all main analysis and figures of the paper.
Additionally, the folder includes the 'detailed-description.md' file, including a description of every script, as well as how to run them in order to reproduce the results.
2. **sim-output** contains the simulation output. It has two folders:
  - 'complete-simulation': this folder is *empty* in the shared repo, due to lack of space. It should include 56000 files (one per iteration) created by the simulation code. If you want a copy of these files, plese email me, and I will be happy to share it.
  - 'processed-simulation-results' includes 7 .rda files that summarize and structure the information of the 56000 files, as described in "code/detailed-description.md". These files are included, and they are the only files necessary to reproduce the main results and figures from the text.
3. **data** contains the data file from Abadie et al. (2010). The data file was retrieved from the CRAN package 'tidysynth' (Dunford, 2023), available online at https://github.com/edunford/tidysynth/tree/master/data.
4. **plots** contains the figures that summarize the results. All these figures can be recreated using the scripts in **code**, following instructions detailed in "code/detailed-description.md". 
    It includes four subfolders:
    - 'manuscript_figures': contains all the figures included in the main text
    - 'coverage': contains all the figures that display coverage, for both bayesian methods, in each condition.
    - 'causal effects': contains the distribution of causal effects (replication of Figure 3 and 4 in the main text) for each of the 56 simulation conditions. It includes the figures using the 'median' as a point estimate (causal_effects/median) and the mean as a point estimate (causal_effects/mean). It also includes the figures taking the counterfactual at each time point as estimand of interest 'conterfactual_time_point', and the average treatment effect in the postintervention period 'average_counterfactual'.
    - 'weights_sparsity' includes the figures that reproduce the figure in Appendix 2 for all conditions

## Reproducibility

In order to reproduce the results, make sure to check the "requirements.txt" as well as the instrictuons in "code/detailed_description.md".

## Ethics

This thesis has received ethical approval by the Ethics Review Board of the Faculty of Social & Behavioural Sciences.

For the simulation part of the study, ethical approval was received with number: 23-1877.
For the extension to the simulation (the reanalysis of data from Abadie et al. 2010), ethical approval was received with number: 24-1720

Note that the simulation is based on data that is entirely generated by us. There is no data on any individual, meaning no sensitive or personal data is disclosed. Additionally, for the reanalysis of data from Abadie et al. (2010), the data is at the level of the state, for some states of the United States of America (e.g., percent of young people, cigarette sales per capita, alcohol consumption per capita). All data is aggregated at the state level, i.e., there is no data whatsoever of any individual. The dataset we used was retrieved from the open R package tidysynth (https://cran.r-project.org/web/packages/tidysynth/index.html), shared under a MIT licence and copyright of the package's author. (See [here](https://github.com/edunford/tidysynth?tab=MIT-2-ov-file))

## Contact

Carlos G. Poses is solely responsible for this Research Archive. If you have a question or a consultation, please contact me at c.gonzalezposes@uu.nl or carlosgonzalezposes@gmail.com


## References

Dunford E (2023). _tidysynth: A Tidy Implementation of the Synthetic Control Method_. R
  package version 0.2.0, <https://CRAN.R-project.org/package=tidysynth>.
Abadie, A., Diamond, A., & Hainmueller, J. (2010). Synthetic control methods for comparative case studies: Estimating the effect of Californiaâ€™s tobacco control program. Journal of the American statistical Association, 105(490), 493-505.
